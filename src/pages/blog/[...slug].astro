---
import BaseHead from "../../components/BaseHead.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import { SITE_TITLE } from "../../consts";

import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("blog");

  return posts.map((post) => {
    const raw = post?.slug ?? post?.id ?? "";
    const slug = raw.replace(/\.(md|mdx)$/i, "");

    return {
      params: { slug },
      props: { post },
    };
  });
}

const { post } = Astro.props;
const { Content } = await render(post);
---

<!doctype html>
<html lang="es">
  <head>
    <BaseHead
      title={`${post.data.title} | ${SITE_TITLE}`}
      description={post.data.description}
    />
  </head>

  <body>
    <Header />

    <main class="container">
      <article class="post">
        <a class="back" href="/blog">‚Üê Volver al blog</a>

        <h1 class="title">{post.data.title}</h1>

        <p class="meta">
          {new Date(post.data.pubDate).toLocaleDateString("es-ES", {
            year: "numeric",
            month: "long",
            day: "numeric",
          })}
        </p>

        <div class="content">
          <Content />
        </div>
      </article>
    </main>

    <Footer />
  </body>
</html>

<style>
  .container { max-width: 820px; margin: 0 auto; padding: 2.5rem 1rem; }
  .back { display: inline-block; margin-bottom: 1rem; text-decoration: none; opacity: .75; }
  .back:hover { opacity: 1; text-decoration: underline; text-underline-offset: 3px; }
  .title { margin: 0 0 .75rem; font-size: 1.8rem; line-height: 1.2; }
  .meta { margin: 0 0 2rem; opacity: .6; }
  .content :global(p) { line-height: 1.75; margin: 0 0 1rem; }
</style>
